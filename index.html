<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta name="theme-color" content="#0c0a14" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#f8f7fc" media="(prefers-color-scheme: light)" />
  <meta name="description" content="法语练习 · TCF 填空、段落填空、单选、多选，支持错题本与习题集管理" />
  <meta name="keywords" content="法语,法语练习,TCF,法语考试,法语语法,填空,单选,多选,错题本" />
  <meta name="author" content="Français Quiz" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Français Quiz · 法语练习" />
  <meta property="og:description" content="法语练习 · TCF 填空、段落填空、单选、多选，支持错题本与习题集管理" />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Français Quiz · 法语练习" />
  <meta name="twitter:description" content="法语练习 · TCF 填空、段落填空、单选、多选，支持错题本与习题集管理" />
  
  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="DENY" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self'; base-uri 'self';" />
  
  <title>Français Quiz · 法语练习</title>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJiZyIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzZkMjhkOSIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzhiNWNmNiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgcng9IjgiIGZpbGw9InVybCgjYmcpIi8+PHJlY3QgeD0iOSIgeT0iOCIgd2lkdGg9IjMuMiIgaGVpZ2h0PSIxNiIgcng9IjEiIGZpbGw9IiNmZmYiLz48cmVjdCB4PSI5IiB5PSI4IiB3aWR0aD0iMTEiIGhlaWdodD0iMi44IiByeD0iMSIgZmlsbD0iI2ZmZiIvPjxyZWN0IHg9IjkiIHk9IjE1IiB3aWR0aD0iNi41IiBoZWlnaHQ9IjIuNiIgcng9IjEiIGZpbGw9IiNmZmYiLz48cGF0aCBkPSJNMTguNSA2LjJsMiAyLjIiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvc3ZnPg==" type="image/svg+xml" />
  <link rel="icon" href="favicon.svg?v=3" type="image/svg+xml" />
  
  <!-- Fonts: Preconnect + Preload -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" as="style" />
  <link id="fonts-stylesheet" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" />
  <noscript><link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet" /></noscript>
  
  <!-- Critical CSS -->
  <link rel="preload" href="css/styles.css" as="style" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <a href="#main" class="skip-link">跳过至主内容</a>
  <div class="container" id="main">
    <header role="banner">
      <div class="brand">
        <h1>Français Quiz</h1>
        <p>TCF 填空 · 段落填空 · 单选 · 多选</p>
      </div>
      <button type="button" class="theme-toggle" id="theme-toggle" title="切换深色/浅色" aria-label="切换深色或浅色主题" aria-pressed="false" aria-keyshortcuts="t">🌓</button>
    </header>

    <main role="main">
    <section id="screen-home" class="screen active" aria-label="首页">
      <div class="stats-bar" id="stats-bar" role="region" aria-label="统计数据">
        <span>今日已练 <strong id="stat-today" aria-live="polite">0</strong> 题</span>
        <span>连续 <strong id="stat-streak" aria-live="polite">0</strong> 天</span>
        <span>错题本 <strong id="stat-wrong" aria-live="polite">0</strong> 题</span>
        <span>习题集 <strong id="stat-sets" aria-live="polite">0</strong> 套</span>
      </div>

      <div class="home-section">
        <h2>开始练习</h2>
        <div class="start-select-wrap">
          <label for="start-practice-select">选择习题集</label>
          <select id="start-practice-select">
            <option value="default">默认题目</option>
          </select>
        </div>
        <div class="category-filter-wrap" id="category-filter-wrap">
          <label for="filter-category">分类筛选</label>
          <select id="filter-category">
            <option value="">全部</option>
          </select>
        </div>

        <!-- Advanced Settings (collapsed by default) -->
        <button type="button" class="collapsible-toggle" aria-expanded="false" aria-controls="advanced-settings-body"><span class="collapsible-chevron">▶</span> 高级设置</button>
        <div class="collapsible-body" id="advanced-settings-body" role="region"><div class="collapsible-inner">
          <div class="timer-wrap">
            <label for="timer-seconds">每题倒计时（秒）</label>
            <input type="number" id="timer-seconds" min="0" max="120" value="10" title="0 表示不限时" />
            <div class="shuffle-wrap">
              <input type="checkbox" id="shuffle-questions" />
              <label for="shuffle-questions">打乱题目顺序</label>
            </div>
            <div class="shuffle-wrap">
              <input type="checkbox" id="shuffle-options" />
              <label for="shuffle-options">打乱选项顺序</label>
            </div>
          </div>
          <div class="type-filter-wrap">
            <span class="type-filter-label">只做以下题型（不勾选 = 全部）</span>
            <div class="type-filter-row">
              <label><input type="checkbox" id="filter-type-single" checked /> 单选</label>
              <label><input type="checkbox" id="filter-type-multiple" checked /> 多选</label>
              <label><input type="checkbox" id="filter-type-fill" checked /> 填空</label>
              <label><input type="checkbox" id="filter-type-paragraph" checked /> 段落填空</label>
            </div>
          </div>
        </div></div>

        <div class="home-actions" role="group" aria-label="主要操作">
          <button type="button" class="btn btn-primary" id="btn-start-practice" aria-label="开始练习">开始练习</button>
          <button type="button" class="btn btn-secondary" id="btn-import-show" aria-expanded="false" aria-controls="import-section">导入我的题目</button>
        </div>

        <!-- Wrong book merged as sub-row -->
        <div class="wrong-book-row">
          <div class="wrong-book-row-label">错题本</div>
          <div class="home-actions" role="group" aria-label="错题本操作">
            <button type="button" class="btn wrong-book-btn" id="btn-wrong-book">按计划复习 (<span id="wrong-count" aria-live="polite">0</span>)</button>
            <button type="button" class="btn btn-secondary" id="btn-wrong-free">自由练习全部</button>
            <button type="button" class="btn btn-secondary" id="btn-clear-wrong" aria-label="清空错题本，此操作不可恢复">清空错题本</button>
          </div>
        </div>

        <div class="import-section" id="import-section" style="display: none;" role="region" aria-labelledby="import-section-title">
        <h3 id="import-section-title">粘贴题目文本（支持你给的格式）</h3>
        <textarea id="import-text" placeholder="粘贴题目文本（见下方说明）或 JSON 数组…"></textarea>
        <div class="import-name-wrap">
          <label for="import-set-name">习题集名称（保存用，填写后本次导入会加入「我的习题集」）</label>
          <input type="text" id="import-set-name" placeholder="例如：avoir 固定表达" autocomplete="off" />
          <label for="import-set-folder" class="import-folder-label">保存到文件夹</label>
          <select id="import-set-folder">
            <option value="">未分类</option>
          </select>
        </div>
        <div class="import-review-wrap">
          <label for="import-review-urls">练习前复习资料（可选，每行一个 URL，开始练习前可先看）</label>
          <textarea id="import-review-urls" rows="3" placeholder="https://…&#10;https://…" autocomplete="off"></textarea>
        </div>
        <p class="import-dup-hint">重复题目（题干+选项+答案相同）将自动跳过，仅保留一道。</p>
        <button type="button" class="btn btn-primary" id="btn-import-parse" style="margin-top: 0.75rem;">解析并开始</button>
        </div>
      </div>

      <div class="home-section saved-sets" id="saved-sets-section">
        <h2>我的习题集</h2>
        <div class="saved-sets-search">
          <div class="saved-sets-search-wrap">
            <input type="text" id="saved-sets-search" placeholder="搜索习题集名称…" autocomplete="off" aria-label="搜索习题集名称" />
          </div>
        </div>
        <div class="saved-sets-folders-bar" id="saved-sets-folders-bar">
          <span class="saved-sets-folders-label">文件夹</span>
          <button type="button" class="btn btn-secondary btn-sm" id="btn-add-folder">添加文件夹</button>
          <div class="saved-sets-folder-tags" id="saved-sets-folder-tags"></div>
        </div>
        <div class="saved-sets-list-wrap">
          <div id="saved-sets-list"></div>
          <p class="saved-sets-empty" id="saved-sets-empty" style="display: none;">暂无保存的习题集，导入题目时填写名称即可保存。</p>
        </div>
      </div>

      <div class="home-section" id="storage-section">
        <h2>数据同步</h2>
        <button type="button" class="btn btn-primary btn-one-save" id="btn-one-save">一键保存（覆盖到项目文件夹）</button>
        <button type="button" class="btn btn-primary btn-one-save" id="btn-load-cloud" style="background: linear-gradient(135deg, #059669, #0d9488);">从云端加载（手机同步习题集）</button>

        <!-- More storage options (collapsed) -->
        <button type="button" class="collapsible-toggle" style="margin-top:0.75rem;" aria-expanded="false" aria-controls="storage-details-body"><span class="collapsible-chevron">▶</span> 更多存储选项与说明</button>
        <div class="collapsible-body" id="storage-details-body" role="region"><div class="collapsible-inner">
          <p class="storage-desc" style="margin-top:0.5rem;">电脑：一键保存到项目里的 <code>french_quiz_data.json</code>。手机要看到同一份习题集：保存后在项目目录执行下方命令，<strong>同时推送主仓库 + Pages 站点</strong>，手机打开本页后点「<strong>从云端加载</strong>」即可同步。</p>
          <p class="storage-security-hint">安全说明：云端习题集来自当前网站里的静态文件，网页<strong>没有上传/推送功能</strong>，访客无法改写你的数据。只有你自己（或你授予写权限的 GitHub 协作者）能在本机执行脚本推送到仓库。</p>
          <div class="storage-grid">
            <button type="button" class="storage-card" id="btn-open-folder">
              <span class="title">打开并加载</span>
              <span class="hint">选择 french-quiz 文件夹，读取本地 JSON</span>
            </button>
            <button type="button" class="storage-card" id="btn-save-to-folder">
              <span class="title">保存到项目文件夹</span>
              <span class="hint">覆盖 french_quiz_data.json</span>
            </button>
            <button type="button" class="storage-card" id="btn-export-data">
              <span class="title">导出到项目文件夹（覆盖）</span>
              <span class="hint">直接写入项目目录，覆盖原文件</span>
            </button>
            <button type="button" class="storage-card" id="btn-import-data">
              <span class="title">从文件导入</span>
              <span class="hint">选择本机 JSON 文件恢复数据</span>
            </button>
          </div>
          <div class="save-success-tip" id="save-success-tip" style="display: none;">
            <p class="save-success-tip-title">已保存。要同步到 GitHub（主仓库 + Pages 站点一起更新）：</p>
            <p class="save-success-tip-desc">在项目目录打开终端，运行（或点击复制），把 <code>../french-quiz-pages</code> 换成你的公开 Pages 仓库路径：</p>
            <div class="save-success-tip-cmd-wrap">
              <code class="save-success-tip-cmd" id="save-deploy-cmd">./scripts/sync-and-push.sh ../french-quiz-pages</code>
              <button type="button" class="btn btn-secondary btn-sm" id="btn-copy-deploy-cmd">复制命令</button>
            </div>
            <p class="save-success-tip-extra">只推当前仓库用 <code>./scripts/sync-and-push.sh</code>；同时更新主仓库+Pages 用 <code>./scripts/sync-and-push.sh ../french-quiz-pages</code>。首次需 <code>chmod +x scripts/sync-and-push.sh</code>。</p>
          </div>
          <div class="import-lock-wrap" id="import-lock-wrap">
            <p class="import-lock-desc">导入保护：仅主人可往「我的习题集」里<strong>新增题目</strong>。PIN 由<strong>你自己在下方点击「设置主人 PIN」时设定</strong>（4～12 位），请牢记。</p>
            <div class="import-lock-status" id="import-lock-status">
              <span id="import-lock-status-text">未启用</span>
              <span class="import-lock-btns">
                <button type="button" class="btn btn-secondary btn-sm" id="btn-import-lock-set">设置主人 PIN</button>
                <button type="button" class="btn btn-secondary btn-sm" id="btn-import-lock-change" style="display:none;">修改 PIN</button>
                <button type="button" class="btn btn-secondary btn-sm" id="btn-import-lock-disable" style="display:none;">关闭保护</button>
              </span>
            </div>
            <div class="import-device-bind" id="import-device-bind">
              <p class="import-lock-desc">仅允许本机导入：绑定后<strong>只有当前这台电脑</strong>能使用「导入我的题目」。</p>
              <div class="import-lock-status">
                <span id="device-bind-status-text">未绑定</span>
                <span class="import-lock-btns">
                  <button type="button" class="btn btn-secondary btn-sm" id="btn-device-bind">绑定本机</button>
                  <button type="button" class="btn btn-secondary btn-sm" id="btn-device-unbind" style="display:none;">解除绑定</button>
                </span>
              </div>
            </div>
          </div>
          <p class="storage-fallback">无法选择文件夹？<a href="#" id="link-download-json">下载 JSON 到电脑</a></p>
          <input type="file" id="file-import-data" accept=".json,application/json" />
        </div></div>
      </div>

      <div class="home-section format-doc" id="format-doc">
        <button type="button" class="collapsible-toggle" aria-expanded="false" aria-controls="format-doc-content"><span class="collapsible-chevron">▶</span> 各题型格式说明</button>
        <div class="collapsible-body" id="format-doc-content" role="region"><div class="collapsible-inner"><div class="format-doc-content">
          <p><strong>通用：</strong>可直接粘贴 JSON 题目数组，或按下方文本格式粘贴。</p>
          <p><span class="type-tag">单选题 single_choice</span></p>
          <pre>{"type":"single_choice","stem":"Nous ______ une lettre.","options":["écris","écrit","écrivons","écrivent"],"correct":2,"explanation":"nous 用 écrivons。","category":"语法"}</pre>
          <p><span class="type-tag">多选题 multiple_choice</span> — correct 为正确选项索引数组。</p>
          <pre>{"type":"multiple_choice","stem":"下列哪些是复数形式？","options":["ils","il","elles","elle"],"correct":[0,2],"explanation":"ils/elles 为复数。"}</pre>
          <p><span class="type-tag">填空题 fill_blank</span> — correct 为答案字符串或可接受答案数组。</p>
          <pre>{"type":"fill_blank","stem":"Il _____ (avoir) 20 ans.","correct":["a","a "],"explanation":"avoir 第三人称单数变位为 a。"}</pre>
          <p><span class="type-tag">段落填空题 paragraph_fill_blank</span> — 题干中用 _____ 表示空，顺序对应 correct 数组。</p>
          <pre>{"type":"paragraph_fill_blank","stem":"Il a _____ ans. Elle _____ (s'appeler) Marie.","correct":["15","s'appelle"],"explanation":"两空依次填写。"}</pre>
          <p><strong>文本格式（单选题）：</strong>含「题型：」「A) B) C) D)」「正确：」即可解析。例：</p>
          <pre>题型：Nous ______ une lettre à nos parents.
A) écris  B) écrit  C) écrivons  D) écrivent
正确：C</pre>
          <p class="format-doc-hint"><strong>分类筛选：</strong>题目 JSON 中可带 <code>category</code> 字段（如 <code>"category":"语法"</code>），选习题集后可按分类筛题；无 <code>category</code> 时仅显示「全部」。</p>
        </div></div></div>
      </div>
    </section>

    <section id="screen-quiz" class="screen" aria-label="练习中">
      <div class="progress-wrap">
        <span class="progress-estimate" id="progress-estimate"></span>
        <span class="progress-label" id="progress-label">第 1 / 1 题</span>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
      </div>
      <div class="question-card" role="region" aria-labelledby="question-stem" aria-describedby="question-meta" aria-live="polite">
        <div class="question-header">
          <div class="question-meta" id="question-meta"></div>
          <div class="question-timer-wrap">
            <svg class="timer-ring" id="timer-ring" width="40" height="40" viewBox="0 0 40 40" style="display:none;">
              <circle cx="20" cy="20" r="17" fill="none" stroke="var(--surface)" stroke-width="3" />
              <circle class="timer-ring-fill" id="timer-ring-fill" cx="20" cy="20" r="17" fill="none" stroke="var(--accent)" stroke-width="3" stroke-dasharray="106.81" stroke-dashoffset="0" stroke-linecap="round" transform="rotate(-90 20 20)" />
            </svg>
            <span class="quiz-timer" id="quiz-timer" style="display: none;"></span>
          </div>
        </div>
        <div class="question-stem-wrap">
          <div class="question-stem" id="question-stem"></div>
          <button type="button" class="btn-read-aloud" id="btn-read-aloud" title="朗读题干（法语）" aria-label="朗读题干（法语）">🔊 朗读</button>
        </div>
        <div class="options" id="options-container" role="group" aria-label="答题选项"></div>
        <div class="fill-input-wrap" id="fill-input-wrap" style="display: none;">
          <label for="fill-input" class="sr-only">输入答案</label>
          <input type="text" id="fill-input" placeholder="输入答案..." autocomplete="off" aria-label="输入答案" aria-required="true" />
        </div>
        <div class="paragraph-blanks" id="paragraph-blanks-wrap" style="display: none;" role="group" aria-label="段落填空"></div>
        <div class="answer-feedback" id="answer-feedback"></div>
        <div class="explanation-scroll-wrap" id="explanation-scroll-wrap" style="display: none;">
          <div class="explanation-wrong-count" id="explanation-wrong-count" style="display: none;" aria-live="polite"></div>
          <div class="explanation" id="explanation"></div>
          <div class="explanation-notes-section" id="explanation-notes-section">
            <div class="explanation-notes-display" id="explanation-notes-display" style="display: none;"></div>
            <button type="button" class="btn btn-secondary btn-sm explanation-notes-edit-btn" id="btn-edit-explanation-notes" aria-label="编辑备注">编辑备注</button>
            <div class="explanation-notes-edit" id="explanation-notes-edit" style="display: none;">
              <textarea id="explanation-notes-textarea" rows="4" placeholder="在此添加你的备注（纯文本），Enter 换行" class="explanation-notes-textarea"></textarea>
              <div class="explanation-notes-edit-actions">
                <button type="button" class="btn btn-primary btn-sm" id="btn-save-explanation-notes">保存</button>
                <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-explanation-notes">取消</button>
              </div>
            </div>
          </div>
        </div>
        <div class="wrong-book-remove-wrap" id="wrong-book-remove-wrap" style="display: none;">
          <button type="button" class="btn btn-secondary btn-sm" id="btn-remove-from-wrong">移出错题本</button>
        </div>
        <div class="remove-from-set-wrap" id="remove-from-set-wrap" style="display: none;">
          <button type="button" class="btn btn-secondary btn-sm" id="btn-remove-from-set">从练习集删除本题</button>
        </div>
      </div>
      <div class="quiz-actions">
        <span id="question-counter"></span>
        <div class="quiz-actions-right">
          <button type="button" class="btn btn-secondary" id="btn-prev-quiz" style="display: none;" aria-label="上一题">上一题</button>
          <button type="button" class="btn btn-secondary" id="btn-exit-quiz" aria-label="提前退出练习">提前退出</button>
          <button type="button" class="btn btn-primary" id="btn-next" style="display: none;" aria-label="下一题" aria-keyshortcuts="Enter">下一题</button>
          <button type="button" class="btn btn-primary" id="btn-submit" aria-label="确认答案" aria-keyshortcuts="Enter">确认</button>
        </div>
      </div>
      <p class="quiz-shortcut-hint" aria-hidden="true">快捷键：1–4 选选项，Enter 确认</p>
    </section>

    <section id="screen-result" class="screen" aria-label="练习结果">
      <div class="result-card" id="result-card" aria-live="polite" aria-atomic="true">
        <div class="result-score" id="result-score" role="text">0/0</div>
        <p class="result-pct" id="result-pct"></p>
        <p class="result-desc" id="result-desc">完成练习</p>
        <p class="result-celebration" id="result-celebration" style="display: none;">🎉 全对！</p>
        <div class="result-confetti" id="result-confetti" aria-hidden="true"></div>
        <div class="result-actions">
          <button type="button" class="btn btn-primary" id="btn-restart" aria-label="再练一遍">再练一遍</button>
          <button type="button" class="btn wrong-book-btn" id="btn-result-wrong" aria-label="错题本按计划复习">错题本·按计划</button>
          <button type="button" class="btn btn-secondary" id="btn-result-wrong-free" aria-label="错题自由练习">错题自由练习</button>
          <button type="button" class="btn btn-secondary" id="btn-share-result" aria-label="分享成绩">分享成绩</button>
          <button type="button" class="btn btn-secondary" id="btn-back-home" aria-label="返回首页">返回首页</button>
        </div>
        <p class="result-shortcut-hint" aria-hidden="true">提示：答题时按 Enter 可下一题，Esc 关闭弹窗</p>
        <div class="result-recent" id="result-recent" style="display: none;"></div>
      </div>
    </section>
    </main>
    
    <div id="sr-announcer" class="sr-only" aria-live="assertive" aria-atomic="true" role="status"></div>
  </div>

  <div class="review-modal-overlay" id="review-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="review-modal-title">
    <div class="review-modal">
      <h3 id="review-modal-title">是否观看复习材料？</h3>
      <div class="review-modal-body">
        <div class="review-modal-texts-wrap" id="review-modal-texts-wrap">
          <div class="review-modal-texts roll" id="review-modal-texts"></div>
        </div>
        <div class="review-modal-links" id="review-modal-links"></div>
        <div class="review-modal-images" id="review-modal-images"></div>
      </div>
      <div class="review-modal-actions">
        <button type="button" class="btn btn-primary" id="btn-review-start-quiz">直接开始练习</button>
      </div>
    </div>
  </div>

  <div class="start-mode-modal-overlay" id="start-mode-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="start-mode-modal-title" style="display: none;">
    <div class="start-mode-modal">
      <h3 id="start-mode-modal-title">选择练习方式</h3>
      <div class="start-mode-review-card" id="start-mode-review-card" style="display: none;">
        <div class="start-mode-review-icon">📚</div>
        <div class="start-mode-review-content">
          <div class="start-mode-review-title">预习内容</div>
          <div class="start-mode-review-desc">本题集包含复习材料，建议先预习再开始练习</div>
        </div>
        <label class="start-mode-review-toggle">
          <input type="checkbox" id="start-mode-review" checked />
          <span class="start-mode-review-switch"></span>
        </label>
      </div>
      <p class="start-mode-desc">本题集题目较多，可选择练习方式与是否打乱顺序。</p>
      <div class="start-mode-cards">
        <div class="start-mode-card start-mode-card-full">
          <div class="start-mode-card-title">练习全部</div>
          <p class="start-mode-card-hint">一次做完本题集全部题目。</p>
          <label class="start-mode-check-wrap">
            <input type="checkbox" id="start-mode-shuffle" />
            <span>打乱题目顺序</span>
          </label>
          <button type="button" class="btn btn-primary start-mode-card-btn" id="btn-start-mode-full">开始练习</button>
        </div>
        <div class="start-mode-card start-mode-card-sequential" id="start-mode-sequential">
          <div class="start-mode-card-title">按顺序练一部分</div>
          <p class="start-mode-card-hint">自选题数，按顺序做；下次从剩余题目继续。</p>
          <div class="start-mode-sequential-wrap">
            <label for="start-mode-count" class="start-mode-sequential-label">练习题目数</label>
            <div class="start-mode-sequential-row">
              <input type="number" id="start-mode-count" min="1" value="20" aria-label="题目数量" />
              <span class="start-mode-sequential-text">题（从第 <span id="start-mode-from">1</span> 题起，剩余 <span id="start-mode-remain">0</span> 题）</span>
            </div>
          </div>
          <button type="button" class="btn btn-primary start-mode-card-btn" id="btn-start-mode-sequential">开始按顺序练习</button>
        </div>
        <div class="start-mode-card start-mode-finished" id="start-mode-finished" style="display: none;">
          <div class="start-mode-card-title">本套已按顺序练完</div>
          <p class="start-mode-card-hint">可重置进度后重新按顺序练，或直接练习全部。</p>
          <div class="start-mode-finished-btns">
            <button type="button" class="btn btn-secondary" id="btn-start-mode-reset">重置进度</button>
            <button type="button" class="btn btn-primary" id="btn-start-mode-full-after">练习全部</button>
          </div>
        </div>
      </div>
      <div class="start-mode-footer">
        <button type="button" class="btn btn-ghost" id="btn-start-mode-cancel" aria-keyshortcuts="Escape">取消</button>
      </div>
    </div>
  </div>

  <div class="image-lightbox-overlay" id="image-lightbox-overlay" role="dialog" aria-modal="true" aria-label="放大查看图片">
    <div class="image-lightbox-content">
      <img id="image-lightbox-img" src="" alt="放大图" />
      <button type="button" class="image-lightbox-close" id="image-lightbox-close" aria-label="关闭" aria-keyshortcuts="Escape">×</button>
    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite" role="status"></div>

  <div class="edit-set-modal-overlay" id="edit-set-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="edit-set-modal-title">
    <div class="edit-set-modal">
      <h3 id="edit-set-modal-title">编辑习题集</h3>
      <div class="edit-set-field">
        <label for="edit-set-name">习题集名称</label>
        <input type="text" id="edit-set-name" placeholder="例如：avoir 固定表达" autocomplete="off" />
      </div>
      <div class="edit-set-field">
        <label for="edit-set-folder">所属文件夹</label>
        <select id="edit-set-folder">
          <option value="">未分类</option>
        </select>
      </div>
      <div class="edit-set-field">
        <span class="edit-set-review-label">练习前复习资料（可选）</span>
        <div class="edit-set-review-row">
          <label for="edit-set-review-texts">文本（每行一段，练习前可滚动查看）</label>
          <textarea id="edit-set-review-texts" rows="3" placeholder="口诀、说明等&#10;每行一段" autocomplete="off"></textarea>
        </div>
        <div class="edit-set-review-row">
          <label for="edit-set-review-links">链接（每行一个 URL）</label>
          <textarea id="edit-set-review-links" rows="2" placeholder="https://…" autocomplete="off"></textarea>
        </div>
        <div class="edit-set-paste-images" id="edit-set-paste-images">
          <span class="edit-set-paste-images-hint">图片：点击下方区域后 Ctrl+V / Cmd+V 粘贴</span>
          <div class="edit-set-paste-zone" id="edit-set-paste-zone" tabindex="0" role="button" aria-label="点击后按 Ctrl+V 或 Cmd+V 粘贴图片">粘贴图片到此处</div>
          <div class="edit-set-pasted-list" id="edit-set-pasted-list"></div>
        </div>
      </div>
      <div class="edit-set-meta" id="edit-set-meta"></div>
      <div class="edit-set-field edit-set-append">
        <label for="edit-set-append-text">追加题目（粘贴 JSON 数组或文本格式，会追加到本题集末尾）</label>
        <textarea id="edit-set-append-text" rows="4" placeholder="[{&quot;type&quot;:&quot;single_choice&quot;, ...}, ...] 或 题型：... A) B) C) D) 正确：C" autocomplete="off"></textarea>
        <button type="button" class="btn btn-secondary btn-sm" id="btn-edit-set-append">解析并追加</button>
      </div>
      <div class="edit-set-actions">
        <button type="button" class="btn btn-primary" id="btn-edit-set-save">保存</button>
        <button type="button" class="btn btn-secondary" id="btn-edit-set-cancel" aria-keyshortcuts="Escape">取消</button>
      </div>
      <div class="edit-set-extra">
        <button type="button" class="btn btn-link" id="btn-edit-set-export">导出本题集 (JSON)</button>
        <span class="edit-set-sep">·</span>
        <button type="button" class="btn btn-link" id="btn-edit-set-preview" aria-haspopup="dialog">预览习题</button>
        <span class="edit-set-sep">·</span>
        <button type="button" class="btn btn-link-danger" id="btn-edit-set-delete">删除本习题集</button>
      </div>
    </div>
  </div>

  <div class="preview-questions-overlay" id="preview-questions-overlay" role="dialog" aria-modal="true" aria-labelledby="preview-questions-title">
    <div class="preview-questions-modal">
      <h3 id="preview-questions-title">习题预览</h3>
      <div class="preview-questions-body" id="preview-questions-body"></div>
      <div class="preview-questions-actions">
        <button type="button" class="btn btn-primary" id="btn-preview-questions-close" aria-keyshortcuts="Escape">关闭</button>
      </div>
    </div>
  </div>

  <script src="js/constants.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/ui-home.js"></script>
  <script src="js/quiz-engine.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
